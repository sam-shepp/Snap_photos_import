import os
import re
from PIL import Image
from datetime import datetime
import piexif
from mutagen.mp4 import MP4
import ffmpeg
import shutil
import tkinter as tk
from tkinter import filedialog
from tqdm import tqdm

folder_path = '/Users/samsheppard/Documents/'

# Create a processed folder inside the same directory
processed_folder = os.path.join(folder_path, "processed")
output_folder = os.path.join(folder_path, "output")
os.makedirs(processed_folder, exist_ok=True)


def overlay_png_on_mp4(mp4_path, png_path, processed_folder):
    """Overlay a resized PNG onto an MP4 and save in processed folder (quiet mode)."""
    if os.path.exists(png_path):
        processing_path = os.path.join(processed_folder, os.path.basename(mp4_path).replace("-main.mp4", "_combined.mp4"))

        print(f'processing_path: {processing_path}')

        # Get MP4 resolution
        probe = ffmpeg.probe(mp4_path)
        video_stream = next((stream for stream in probe["streams"] if stream["codec_type"] == "video"), None)
        if video_stream:
            width = video_stream["width"]
            height = video_stream["height"]
            print(f"MP4 Dimensions: {width}x{height}")

            if width > height:
                # Use FFmpeg to scale the overlay to match